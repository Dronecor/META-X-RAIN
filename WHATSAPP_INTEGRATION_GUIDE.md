# Twilio WhatsApp Integration Guide

## 1. Prerequisites
- A Twilio Account.
- Detailed environment variables in your `.env` file (copied from `.env.example`).
- **Ngrok** installed (to test locally).

## 2. Environment Variables
Ensure these are set in your `.env` file:
```env
TWILIO_ACCOUNT_SID=your_sid_here
TWILIO_AUTH_TOKEN=your_token_here
TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886  # Default Twilio Sandbox Number
```

## 3. Local Setup (Ngrok)
Since Twilio needs to send data to your local backend, you must expose it to the internet.

1. **Start Backend**: Ensure your backend is running (`python -m uvicorn backend.main:app --reload`).
2. **Start Ngrok**:
   ```bash
   ngrok http 8000
   ```
3. **Copy URL**: specific `https` URL generated by ngrok (e.g., `https://1234-56-78.ngrok-free.app`).

## 4. Configure Twilio Sandbox
1. Go to [Twilio Console > Messaging > Try it out > Send a WhatsApp message](https://console.twilio.com/).
2. Click **"Sandbox Settings"**.
3. In the **"When a message comes in"** field, paste your ngrok URL with the webhook endpoint:
   ```
   https://YOUR-NGROK-ID.ngrok-free.app/api/v1/whatsapp/webhook
   ```
4. Click **Save**.

## 5. Testing
1. **Join Sandbox**: Send the join code (e.g., `join something-random`) from your phone to the Twilio number.
2. **Opt-In**: Send "YES" or "START" to opt-in to the bot.
3. **Chat**: Ask "Show me some shoes" or upload an image to test visual search!

## 6. Production Deployment
When deploying to Vercel/Railway, replace the ngrok URL in Twilio with your production API URL:
```
https://shopbuddy-mk97.onrender.com/api/v1/whatsapp/webhook
```

## 7. Connecting Frontends

Since your backend is live at `https://shopbuddy-mk97.onrender.com/api/v1`:

1.  **Next.js App**: Update `.env.local`
    ```env
    NEXT_PUBLIC_BACKEND_API_URL=https://shopbuddy-mk97.onrender.com/api/v1
    ```

2.  **Streamlit App**:
    -   When running locally: `export BACKEND_API_URL=https://shopbuddy-mk97.onrender.com/api/v1`
    -   Or hardcode it in `app.py` for convenience.
```
